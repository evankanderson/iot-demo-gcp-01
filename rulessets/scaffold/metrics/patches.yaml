kinds:
  - serving.knative.dev/v1alpha1:Service
  - apps/v1:Deployment
labelsMatch:
  - airspot.krules.dev/type: ^rulesset$
patch:
  metadata:
    labels:
      app-domain: metrics
  spec:
    template:
      spec:
        containers:
          - patch__0:
              env:
                - name: KRULES_APPS_METRICS_MONGODB_PASSWORD
                  valueFrom:
                    secretKeyRef:
                      name: config-krules-metrics-mongodb-auth
                      key: password
              volumeMounts:
                - name: config-krules-metrics-mongodb-volume
                  mountPath: /krules/config/apps/metrics/mongodb

        volumes:
          - name: config-krules-metrics-mongodb-volume
            configMap:
              name: config-krules-metrics-mongodb
